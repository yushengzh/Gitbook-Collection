# Lecture 3ï¼šå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰

> Lectured by HUNG-YI LEE (æå®æ¯…) Recorded by Yusheng zhaoï¼ˆyszhao0717@gmail.comï¼‰

***

> é€è¿‡Convolutional Neural Networkï¼ˆCNNï¼‰è¿™ä¸ªä¾‹å­ï¼Œæ¥æ¢è®¨networkæ¶æ„çš„æ€æƒ³ã€‚

CNNæ˜¯ä¸“é—¨åº”ç”¨åœ¨å½±åƒæ•°æ®ä¸Šçš„ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨è¦åšImage Classificationä»»åŠ¡ã€‚æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªå‰æï¼šè¾“å…¥å›¾åƒå°ºå¯¸æ˜¯ä¸€å®šçš„ï¼ˆå¦‚æœæœ‰å›¾å½¢ä¸ä¸€å°±å…ˆrescaleæˆä¸€æ ·å¤§ï¼‰ï¼›æ¨¡å‹çš„ç›®æ ‡æ˜¯åˆ†ç±»ï¼Œæ‰€ä»¥æ¯ä¸ªclassï¼ˆç±»ï¼‰è¡¨ç¤ºæˆä¸€ä¸ª**one-hot**çš„å‘é‡ï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœæ˜¯$\hat{y}$â€”â€”è¿™ä¸ªå‘é‡çš„ç»´åº¦ä»£è¡¨äº†åˆ†ç±»å™¨å¯è¾¨è¯†å‡ºçš„ç§ç±»æ•°ã€‚

![](https://s1.328888.xyz/2022/05/03/h9NK0.png)

ä¸€å¼ å›¾ç‰‡ $=$ ä¸‰ç»´çš„å¼ é‡ï¼ˆå®½ã€é«˜ã€channelï¼‰ã€‚æ¯éš”pixelç”±ï¼ˆRï¼ŒGï¼ŒBï¼‰ç»„æˆã€‚è¾“å…¥å‘é‡ï¼ˆ=ä¸‰ç»´çš„å¼ é‡ï¼‰ï¼Œå‡å¦‚å®½é«˜ä¸º28Ã—28ï¼Œåˆ™è¾“å…¥å‘é‡å°ºåº¦ä¸º28Ã—28Ã—3ï¼ˆ28Ã—72ï¼‰ã€‚

å¦‚æœè¾“å…¥ç¬¬ä¸€å±‚networkæ˜¯å…¨è¿æ¥å±‚ï¼Œé‚£ä¹ˆå‚æ•°ä¸º28Ã—28Ã—ç¥ç»å…ƒçš„æ•°é‡ã€‚å¦‚æ­¤å¤šçš„å‚æ•°å¾ˆå®¹æ˜“å¯¼è‡´overfittingï¼Œè€Œä¸”è®­ç»ƒçš„ä»£ä»·ä¹Ÿå¢å¤§ã€‚æˆ‘ä»¬å¯å¦å‡å°‘å‚æ•°å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆè®¤çŸ¥ä¸‹å›¾åƒæœ¬èº«çš„è‹¥å¹²ç‰¹ç‚¹ğŸ‘‡

* \==_Observation 1_ï¼š==å›¾åƒåˆ†ç±»ä¸€ä¸ªé‡è¦çš„æ€æƒ³åœ¨äºä¸ºäº†åœ¨å›¾åƒä¸­è¯†åˆ«ç±»åˆ«ï¼Œè¦å»å¯»æ‰¾åœ¨å›¾åƒä¸­å­˜åœ¨ç±»åˆ«ç›¸å…³çš„ç‰¹åˆ«çš„patternï¼Œä¸€ä¸ªneuronå¹¶ä¸èƒ½çœ‹åˆ°æ•´å¼ å›¾ç‰‡ï¼Œæ¯ä¸ªç¥ç»å…ƒçœ‹åˆ°å›¾åƒçš„ä¸€éƒ¨åˆ†åŒ…å«patternï¼Œä¸€èµ·å†³å®šåˆ¤å®šçš„ç»“æœã€‚äº‹å®ä¸Šï¼Œäººåœ¨è§‚å¯Ÿä¸­ä¹Ÿä¼šæŠ“ä½ç‰©ä»¶çš„ä¸»è¦ç‰¹å¾æ¥æ˜¯åˆ¤åˆ«æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚Soä»¥ä¸‹ç»™å‡ºè¿™ä¸ªæ€æƒ³å¸¦æ¥çš„networkçš„å˜åŒ–ï¼Œç®€åŒ–ä»¥å°½é‡é¿å…åˆå§‹å±‚çš„å…¨è¿æ¥å±‚ã€‚
  *   _Simplification 1_

      ![](https://s1.328888.xyz/2022/05/03/h9BAF.png)

      è¿™é‡Œæå‡ºäº†\*\*æ„Ÿå—é‡ï¼ˆReception fieldï¼‰\*\*çš„æ¦‚å¿µï¼Œè®¾å®šä¸€ä¸ªåŒºåŸŸï¼Œåªè®©ä¸€ä¸ªç‰¹å®šçš„neuronå…³å¿ƒè¿™éƒ¨åˆ†åŒºåŸŸï¼ŒæŠŠè¿™é‡Œ3Ã—3Ã—3çš„å‘é‡æ‹‰ç›´ï¼Œå˜æˆ27ç»´çš„åˆ—å‘é‡ï¼Œå†é€å…¥ä¸‹ä¸€å±‚ç¥ç»å…ƒä¸­ã€‚æ¯ä¸€ä¸ªneuronéƒ½æœ‰è‡ªå·±å¯¹åº”çš„Reception Fieldã€‚å¦å¤–ï¼Œæ„Ÿå—é‡ä¹‹é—´èŒƒå›´äº¦å¯ä»¥é‡å çš„ï¼›å¤šä¸ªneuronä¹Ÿå¯ä»¥å®ˆå¤‡åŒä¸ªæ„Ÿå—é‡ï¼›æ„Ÿå—é‡çš„èŒƒå›´å¯ä»¥è°ƒæ•´ï¼ˆä¾æ®patternï¼‰ä»¥åŠæ„Ÿå—é‡å¯ä»¥coveræŸäº›/ä¸€ä¸ªchannelï¼ˆä¸€èˆ¬CNNä¸å¤ªå¸¸ç”¨ï¼‰ï¼›åŒºåŸŸä¹Ÿå¯ä»¥æ˜¯é•¿æ–¹å½¢ã€‚

      ![](https://s1.328888.xyz/2022/05/03/h9EYW.png)

      æœ€ç»å…¸çš„æ„Ÿå—é‡è®¾è®¡æ–¹å¼ï¼šåªè€ƒè™‘å…¶**é«˜å’Œå®½ï¼ˆkernel sizeï¼‰**ï¼Œé€šå¸¸3Ã—3.ä¸éœ€è¦è€ƒè™‘channelï¼ˆå³é»˜è®¤all channelï¼‰ã€‚ä¸€ä¸ªReceptive Fieldéƒ½æœ‰ä¸€ç»„ç¥ç»å…ƒå»å®ˆå¤‡ã€‚è¿™ä¸ªkernelæ”¹å˜çš„ç›¸å¯¹ä½ç½®ï¼Œå…¶ç§»åŠ¨çš„é‡ç§°ä¹‹ä¸º**Stride**ï¼Œä¸€èˆ¬Strideè®¾è®¡ä¸º1æˆ–2ã€‚åœ¨æœ‰åºæ‰«å›¾ç‰‡æ—¶æœ‰å¯èƒ½ä¼šè¶…å‡ºæœ¬èº«å›¾åƒå°ºå¯¸ï¼Œè¿™é‡Œç”¨åˆ°**padding**â€”â€”è¶…å‡ºéƒ¨åˆ†è¡¥å€¼ï¼ˆæœ€æ™®éçš„æ˜¯è¡¥0ï¼‰ã€‚

      ![](https://s1.328888.xyz/2022/05/03/h9PMy.png)
*   \==_Observation 2_ï¼šThe same pattern appear in different regions==

    åŒæ ·çš„patternï¼ˆå±€éƒ¨ç‰¹å¾ï¼‰åœ¨å›¾åƒä¸­çš„åæ ‡ä½ç½®ä¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½è®©ä¸åŒçš„receptive fieldä¸€èµ·å…±äº«å‚æ•°ï¼Ÿï¼ˆ**Parameters sharing**ï¼‰

    ![](https://s1.328888.xyz/2022/05/03/hJQXk.png)

    â€‹ ä¸Šå›¾ä¸­ï¼Œç›¸åŒé¢œè‰²çš„æƒé‡weightæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¾“å‡ºä¸ä¼šæ˜¯ä¸€æ ·çš„ã€‚è®©å‡ ä¸ªneuronä¸€èµ· å…±äº«å‚æ•°æ˜¯è¿™èŠ‚çš„ç¬¬äºŒä¸ªç®€åŒ–ã€‚

    â€‹ å…¸å‹çš„è®¾è®¡æ–¹å¼ï¼š1ã€æ¯ä¸ªreceptive fieldéƒ½æœ‰ä¸€ç»„neuronsï¼ˆæ¯”æ–¹è¯´64ä¸ªï¼‰ï¼›2ã€æ¯éš”receptive fieldéƒ½æœ‰ç¥ç»å…ƒå…±äº«å‚æ•°ã€‚

    â€‹ ![](https://s1.328888.xyz/2022/05/03/hJUpd.png)

### ==Benefit of Convolutional Layer==

Fully Connected Layerå…¨è¿æ¥å±‚ï¼ˆå¼¹æ€§æœ€å¤§ï¼‰===>å¯ä»¥ä»ä¸€äº›patternsåˆ†ç±»ä¸€å¼ å›¾åƒï¼Œå¾—åˆ°receptive fieldï¼ˆå¼¹æ€§å˜å°ï¼‰ ==> å…±äº«å‚æ•°ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼ˆå®šä¹‰äº†ï¼‰ï¼š

_**Convolutional Layer = Receptive Field + Parameter Sharing**_

åŒ…å«äº†**Convolutional Layer**çš„networkå°±æ˜¯**Convolutional Neuron Networkï¼ˆCNNï¼‰**ã€‚å¯ä»¥çœ‹åˆ°è™½ç„¶CNNçš„bodel biaså¾ˆå¤§ï¼Œä½†æ˜¯ç”±äºCNNçš„è®¾è®¡ç‰¹ç‚¹æ˜¯é’ˆå¯¹å›¾åƒè¯†åˆ«çš„ï¼Œæ‰€ä»¥èƒ½åœ¨å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸Šè¡¨ç°ä¸ä¿—ã€‚

![](https://s1.328888.xyz/2022/05/03/hJeFQ.png)

ä¸Šè¿°ä¸­æ‰€è¯´çš„â€œå…±äº«å‚æ•°â€å³filterï¼ˆsize:3Ã—3Ã—channelï¼‰ï¼Œneuronçš„æƒé‡weightå°±æ˜¯å¼ é‡filterçš„ç»„æˆæ•°å€¼å†…å®¹ã€‚Filterçš„é«˜åº¦å°±æ˜¯å¾…å¤„ç†å›¾åƒçš„channelï¼Œä½†ç¬¬äºŒå±‚çš„filterä¸ä¸€æ ·ã€‚è€ƒè™‘ä¸€å®šèŒƒå›´çš„filterçœŸå®è€ƒè™‘åˆ°çš„feature mapçš„èŒƒå›´æ›´å¤§ã€‚**æ­¤å¤„æ„ä¹‰çš„å·ç§¯ï¼ˆConvolutionalï¼‰ï¼šä¸€ä¸ªfilteræ‰«è¿‡æ•´å¼ å›¾åƒã€‚**ï¼ˆæˆ–è€…ä¸åŒçš„neuronsé—´å¯ä»¥å…±äº«å‚æ•°ï¼‰

*   \==_Observation 3_ï¼šSubsampling the pixels will not change the object==

    **æ± åŒ–ï¼ˆPoolingï¼‰**ï¼šå›¾åƒä¸‹é‡‡æ ·ï¼ŒæŠŠä¸€å¼ å¤§çš„å›¾åƒç¼©å°ã€‚åƒä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼Œé‡Œé¢æ²¡æœ‰è¦learnçš„ä¸œè¥¿ï¼Œæ˜¯ä¸€ä¸ªoperatorã€‚æœ€ä¸»è¦çš„ç†ç”±æ˜¯å‡å°‘è¿ç®—é‡ï¼Œå¦‚æœç®—åŠ›è¶³å¤Ÿï¼Œpoolingå¯æœ‰å¯æ— ã€‚

    *   Pooling - Max Pooling

        åˆ†ç»„ï¼šè‹¥å¹²ä¸ªä¸€ç»„ï¼Œæ¯ç»„é€‰æœ€å¤§çš„ä»£è¡¨è¯¥ç»„
    *   Pooling - Mean Pooling

        åˆ†ç»„ï¼šè‹¥å¹²ä¸ªä¸€ç»„ï¼Œæ¯ç»„é€‰å¹³å‡å€¼ä»£è¡¨è¯¥ç»„
    * å„å¼å„æ ·çš„poolingæ–¹æ³•éƒ½æœ‰ï¼Œå¦‚ä½•åˆ†ç»„æœ‰è‡ªå·±å†³å®š

    _**Convolutional Layer + Pooling**_ï¼šå›¾åƒ===>å·ç§¯å±‚ ==>Pooling

    ![](https://s1.328888.xyz/2022/05/03/hJyy3.png)

ä¸‹é¢å±•ç¤ºæ•´ä¸ªCNNçš„æ ·å­ï¼š

![](https://s1.328888.xyz/2022/05/03/hJgKB.png)

**flatten**çš„ä½œç”¨å°±æ˜¯æŠŠå›¾åƒä¸­çš„çŸ©é˜µæ‹‰ç›´å˜æˆä¸€ä¸ªå‘é‡ï¼Œç„¶åè¾“å…¥ä¸€ä¸ªFully Connected Layersï¼Œä¹‹åå¯èƒ½è¦ç»è¿‡ä¸€ä¸ª$softmax$ï¼Œç„¶åæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå›¾åƒè¾©è¯†çš„ç»“æœã€‚

***

### \*CNNç”¨æ¥ä¸‹å›´æ£‹

æŠŠæ£‹ç›˜ä¸­çš„ç›˜åŠ¿å½“ä½œå‘é‡ï¼ˆ19Ã—19 vectorï¼‰ï¼Œè½å­ï¼ˆBlackï¼š1ï¼›whiteï¼š-1ï¼›noneï¼š0ï¼‰è¾“å…¥networkï¼Œå½“ä½œä¸€ä¸ª19Ã—19çš„åˆ†ç±»é—®é¢˜ã€‚

ä»€ä¹ˆåœ°æ–¹ï¼ˆç¬¦åˆä»€ä¹ˆæ ·ç‰¹å¾çš„ä»»åŠ¡ï¼‰å¯ä»¥é€‚åˆç”¨CNNå‘¢ï¼Ÿ

* Some pattern are much smaller than the whole image
* The same patterns appear in different regions
* Subsamplingthe pixels will not change the objectï¼ˆä¸‹å›´æ£‹ä¾‹å¦‚alphaGoä¸ç”¨poolingï¼‰

é’ˆå¯¹ä¸åŒçš„ä»»åŠ¡ï¼ŒCNNä¸­çš„å…·ä½“è®¾è®¡è‚¯å®šç¨æœ‰ä¸åŒ

### ç¼ºç‚¹

*   CNN is not invariant to scaling and rotation (we need data augmentation â˜ºå›¾åƒæ”¾å¤§åé€‚åˆåŸå›¾çš„è®­ç»ƒçš„CNNç½‘ç»œå¤±æ•ˆäº†ã€‚CNNä¸èƒ½å¤Ÿå¤„ç†å›¾åƒçš„æ”¾å¤§ç¼©å°ï¼Œæˆ–è€…æ—‹è½¬ã€‚å› æ­¤ï¼Œåœ¨å›¾åƒè¯†åˆ«ä¸­ï¼Œå¾€å¾€è¦åšData Augmentationï¼ˆå‰é¢è®²è¿‡çš„ï¼Œæ•°æ®æ‰©å¢ï¼‰

    [Spatial Transformer Layer](https://youtu.be/SoCywZ1hZak)å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
